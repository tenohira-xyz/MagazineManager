# 詳細
サーバサイドの処理を記述する。（= Controller）

## セキュリティ設定事項
### ログイン
#### ログイン無しでもアクセス可能な画面
- ログイン画面
- 雑誌一覧画面
- 雑誌詳細画面
- 目次画面
- 索引画面
#### ログインが必要な画面
- 雑誌新規登録画面
#### ログイン画面のURL
/login
#### ログイン処理のURL
/login
#### セッション切れエラー画面のURL
/error/session
### ログアウト
#### ログアウト処理のURL
/logout
#### ログアウト後に遷移するURL
/list
### アクセス権限による実行制御
コントローラクラスの該当のメソッドに、以下のようなアノテーションを付加する。
```
@PreAuthorize("hasAuthority('ROLE_ADMIN')")
```
要求される権限以外でアクセスした場合は403エラーを返す。  
→403エラー画面を用意する。  
### セッション管理
セッション切れの検知はSpring Securityの機能を使う。  
セッションが切れた場合のエラー画面の遷移方法は以下の方法で実現可能。  
1. `@EnableWebSecurity`と`@Configuration`を付加したクラスで設定する。  
1. エラーページの指定は以下のように設定する。
    ```
        http.sessionManagement().invalidSessionUrl("/error/session"); // セッションエラー後の遷移先
    ```


## 雑誌一覧画面
### 初期表示
「magazineList.html」の内容を表示する。
### ログアウト
上記、セキュリティ設定事項のログアウトの欄を参照。
### 削除
1. ユーザが管理者権限でログインしているかをチェックする。
    1. 管理者権限以外の場合、アクセス不可エラー画面に遷移する。
    1. セッションが切れた場合、セッション切れエラー画面に遷移する。
1. パラメータから「雑誌ID」が取得できるかを判断
    1. 取得できない場合、雑誌未指定エラー画面に遷移する。
1. 「雑誌ID」を雑誌リポジトリクラスの存在チェックメソッドに渡し、指定した雑誌のレコードが存在するかチェックする。
    1. 存在しない場合、雑誌非存在エラー画面に遷移する。
1. 「雑誌ID」を雑誌リポジトリクラスの削除メソッドに渡して、削除処理を実行する。
1. 削除処理の実行結果を比較
    1. 成功した場合、雑誌一覧画面に遷移する。
    1. 失敗した場合、共通エラー画面に遷移する。

## 雑誌新規登録画面
### 初期表示
「register.html」の内容を表示する。
### ログアウト
上記、セキュリティ設定事項のログアウトの欄を参照。
### 登録
1. ユーザが管理者権限でログインしているかをチェックする。
    1. 管理者権限以外の場合、アクセス不可エラー画面に遷移する。
    1. セッションが切れた場合、セッション切れエラー画面に遷移する。
1. フォームに入力された「雑誌名」と「号数」を雑誌リポジトリクラスの存在チェックメソッドに渡し、指定した雑誌のレコードが存在するかチェックする。
    1. 存在する場合、雑誌登録済エラー画面に遷移する。
1. 「雑誌名」と「号数」を雑誌リポジトリクラスの登録メソッドに渡して、登録処理を実行する。
1. 登録処理の実行結果を比較
    1. 成功した場合、雑誌一覧画面に遷移する。
    1. 失敗した場合、共通エラー画面に遷移する。

## 雑誌詳細画面
### 初期表示
「detail.html」の内容を表示する。
### ログアウト
上記、セキュリティ設定事項のログアウトの欄を参照。
### 更新
1. ユーザが管理者権限でログインしているかをチェックする。
    1. 管理者権限以外の場合、アクセス不可エラー画面に遷移する。
    1. セッションが切れた場合、セッション切れエラー画面に遷移する。
1. 「雑誌ID」を雑誌リポジトリクラスの存在チェックメソッドに渡し、指定した雑誌のレコードが存在するかチェックする。
    1. 存在しない場合、雑誌非存在エラー画面に遷移する。
1. 「雑誌ID」「雑誌名」「号数」「出版社」「発行日」を雑誌リポジトリクラスの更新メソッドに渡して、更新処理を実行する。
1. 更新処理の実行結果を比較
    1. 成功した場合、雑誌一覧画面に遷移する。
    1. 失敗した場合、共通エラー画面に遷移する。

## 目次画面
### 初期表示
「contentsList.html」の内容を表示する。
### ログアウト
上記、セキュリティ設定事項のログアウトの欄を参照。
### 登録
1. ユーザが管理者権限でログインしているかをチェックする。
    1. 管理者権限以外の場合、アクセス不可エラー画面に遷移する。
    1. セッションが切れた場合、セッション切れエラー画面に遷移する。
1. 「雑誌ID」を雑誌リポジトリクラスの存在チェックメソッドに渡し、指定した雑誌のレコードが存在するかチェックする。
    1. 存在しない場合、雑誌非存在エラー画面に遷移する。
1. 「雑誌ID」を目次リポジトリクラスの削除メソッドに渡して、削除処理を実行する。
1. 「雑誌ID」および複数の「セクション」「タイトル」「開始ページ」を目次リポジトリクラスの登録メソッドに渡して、登録処理を実行する。
1. 登録処理の実行結果を比較
    1. 成功した場合、雑誌一覧画面に遷移する。
    1. 失敗した場合、共通エラー画面に遷移する。

## 索引画面
### 初期表示
「indexList.html」の内容を表示する。
### ログアウト
上記、セキュリティ設定事項のログアウトの欄を参照。
### 更新
1. ユーザが管理者権限でログインしているかをチェックする。
    1. 管理者権限以外の場合、アクセス不可エラー画面に遷移する。
    1. セッションが切れた場合、セッション切れエラー画面に遷移する。
1. 「雑誌ID」を雑誌リポジトリクラスの存在チェックメソッドに渡し、指定した雑誌のレコードが存在するかチェックする。
    1. 存在しない場合、雑誌非存在エラー画面に遷移する。
1. 「雑誌ID」を索引リポジトリクラスの削除メソッドに渡して、削除処理を実行する。
1. 「雑誌ID」および複数の「キーワード」「開始ページ」を索引リポジトリクラスの登録メソッドに渡して、登録処理を実行する。
1. 登録処理の実行結果を比較
    1. 成功した場合、雑誌一覧画面に遷移する。
    1. 失敗した場合、共通エラー画面に遷移する。
